# üöÄ –í–∞—Ä–∏–∞–Ω—Ç 1: –ë—ã—Å—Ç—Ä–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

## –ß—Ç–æ –¥–µ–ª–∞–µ–º
–î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏, —á—Ç–æ–±—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å—Ç–∏–ª–æ—Å—å –¥–∞–∂–µ –µ—Å–ª–∏ —á—Ç–æ-—Ç–æ —É–ø–∞–ª–æ.

## –®–∞–≥–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### 1. –°–æ–∑–¥–∞—Ç—å —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `lib/screens/loading_screen.dart`:

```dart
import 'package:flutter/material.dart';
import '../utils/constants.dart';

class LoadingScreen extends StatelessWidget {
  final String message;
  final bool hasError;
  final String? errorMessage;
  
  const LoadingScreen({
    super.key,
    this.message = '–ó–∞–≥—Ä—É–∑–∫–∞...',
    this.hasError = false,
    this.errorMessage,
  });

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: AppConstants.backgroundColor,
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            if (!hasError) ...[
              CircularProgressIndicator(
                color: AppConstants.phase3Color,
              ),
              const SizedBox(height: 30),
              Text(
                message,
                style: TextStyle(
                  color: AppConstants.textPrimaryColor,
                  fontSize: 16,
                  letterSpacing: 2,
                ),
              ),
            ] else ...[
              Icon(
                Icons.error_outline,
                size: 64,
                color: AppConstants.phase3Color,
              ),
              const SizedBox(height: 20),
              Text(
                '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏',
                style: TextStyle(
                  color: AppConstants.phase3Color,
                  fontSize: 20,
                  fontWeight: FontWeight.bold,
                ),
              ),
              const SizedBox(height: 10),
              Padding(
                padding: const EdgeInsets.symmetric(horizontal: 40),
                child: Text(
                  errorMessage ?? '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞',
                  textAlign: TextAlign.center,
                  style: TextStyle(
                    color: AppConstants.textSecondaryColor,
                    fontSize: 14,
                  ),
                ),
              ),
              const SizedBox(height: 30),
              ElevatedButton(
                onPressed: () {
                  // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
                  Navigator.of(context).pushReplacementNamed('/');
                },
                style: ElevatedButton.styleFrom(
                  backgroundColor: AppConstants.phase3Color,
                ),
                child: const Text('–ü–û–í–¢–û–†–ò–¢–¨'),
              ),
            ],
          ],
        ),
      ),
    );
  }
}
```

### 2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å main.dart
–ó–∞–º–µ–Ω–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π `lib/main.dart` –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—É—é –≤–µ—Ä—Å–∏—é:

```dart
import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:provider/provider.dart';
import 'package:wakelock_plus/wakelock_plus.dart';
import 'providers/timer_provider.dart';
import 'providers/stats_provider.dart';
import 'screens/main_screen.dart';
import 'screens/stats_screen.dart';
import 'screens/settings_screen.dart';
import 'screens/paywall_screen.dart';
import 'screens/loading_screen.dart';
import 'utils/constants.dart';
import 'package:just_audio_background/just_audio_background.dart';

void main() async {
  // ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
  runZonedGuarded(() async {
    WidgetsFlutterBinding.ensureInitialized();

    // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ
    try {
      await JustAudioBackground.init(
        androidNotificationChannelId: 'com.example.bypass_1236.channel.audio',
        androidNotificationChannelName: 'Audio playback',
        androidNotificationOngoing: true,
        androidNotificationIcon: 'mipmap/ic_launcher',
      );
      debugPrint('‚úÖ JustAudioBackground initialized');
    } catch (e) {
      debugPrint('‚ö†Ô∏è JustAudioBackground init failed: $e');
      // –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É –±–µ–∑ –∞—É–¥–∏–æ-–±—ç–∫–≥—Ä–∞—É–Ω–¥–∞
    }

    // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏
    try {
      await SystemChrome.setPreferredOrientations([
        DeviceOrientation.portraitUp,
        DeviceOrientation.portraitDown,
      ]);
      debugPrint('‚úÖ Orientation set');
    } catch (e) {
      debugPrint('‚ö†Ô∏è Orientation setup failed: $e');
    }

    // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ UI
    try {
      SystemChrome.setEnabledSystemUIMode(
        SystemUiMode.edgeToEdge,
        overlays: [SystemUiOverlay.top],
      );
      debugPrint('‚úÖ SystemUI configured');
    } catch (e) {
      debugPrint('‚ö†Ô∏è SystemUI setup failed: $e');
    }

    runApp(const BypassApp());
  }, (error, stack) {
    debugPrint('üí• CRITICAL ERROR: $error');
    debugPrint('Stack: $stack');
  });
}

class BypassApp extends StatelessWidget {
  const BypassApp({super.key});

  @override
  Widget build(BuildContext context) {
    debugPrint('üé® Building BypassApp');
    
    return MultiProvider(
      providers: [
        ChangeNotifierProvider(create: (_) => StatsProvider()),
        ChangeNotifierProxyProvider<StatsProvider, TimerProvider>(
          create: (_) => TimerProvider(),
          update: (_, statsProvider, timerProvider) {
            timerProvider!.setStatsProvider(statsProvider);
            return timerProvider;
          },
        ),
      ],
      child: MaterialApp(
        title: 'BYPASS-1236',
        debugShowCheckedModeBanner: false,
        theme: ThemeData(
          brightness: Brightness.dark,
          scaffoldBackgroundColor: AppConstants.backgroundColor,
          primaryColor: AppConstants.phase3Color,
          fontFamily: 'Roboto',
          textTheme: const TextTheme(
            bodyLarge: TextStyle(color: Colors.white),
            bodyMedium: TextStyle(color: Colors.white),
          ),
        ),
        initialRoute: '/',
        routes: {
          '/': (context) => const SafeHomePage(),
          '/paywall': (context) => const PaywallScreen(),
        },
      ),
    );
  }
}

/// –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—ë—Ä—Ç–∫–∞ HomePage —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
class SafeHomePage extends StatefulWidget {
  const SafeHomePage({super.key});

  @override
  State<SafeHomePage> createState() => _SafeHomePageState();
}

class _SafeHomePageState extends State<SafeHomePage> {
  bool _isInitialized = false;
  bool _hasError = false;
  String? _errorMessage;

  @override
  void initState() {
    super.initState();
    _safeInitialize();
  }

  Future<void> _safeInitialize() async {
    debugPrint('üîß Starting safe initialization...');
    
    try {
      // –í–∫–ª—é—á–∞–µ–º wakelock
      try {
        await WakelockPlus.enable();
        debugPrint('‚úÖ Wakelock enabled');
      } catch (e) {
        debugPrint('‚ö†Ô∏è Wakelock failed: $e');
      }

      // –ñ–¥—ë–º —Å–ª–µ–¥—É—é—â–∏–π —Ñ—Ä–µ–π–º –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º context
      await Future.delayed(Duration.zero);
      
      if (!mounted) {
        debugPrint('‚ö†Ô∏è Widget unmounted during init');
        return;
      }

      final statsProvider = context.read<StatsProvider>();
      final timerProvider = context.read<TimerProvider>();

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã —Å —Ç–∞–π–º–∞—É—Ç–æ–º
      debugPrint('üìä Initializing StatsProvider...');
      await statsProvider.initialize().timeout(
        const Duration(seconds: 5),
        onTimeout: () {
          debugPrint('‚ö†Ô∏è StatsProvider init timeout');
          throw TimeoutException('Stats initialization timeout');
        },
      );
      debugPrint('‚úÖ StatsProvider initialized');

      debugPrint('‚è±Ô∏è Initializing TimerProvider...');
      await timerProvider.initialize().timeout(
        const Duration(seconds: 5),
        onTimeout: () {
          debugPrint('‚ö†Ô∏è TimerProvider init timeout');
          throw TimeoutException('Timer initialization timeout');
        },
      );
      debugPrint('‚úÖ TimerProvider initialized');

      if (mounted) {
        setState(() {
          _isInitialized = true;
        });
        debugPrint('üéâ Initialization complete!');
      }
    } catch (e, stack) {
      debugPrint('üí• Initialization error: $e');
      debugPrint('Stack: $stack');
      
      if (mounted) {
        setState(() {
          _hasError = true;
          _errorMessage = e.toString();
        });
      }
    }
  }

  @override
  void dispose() {
    WakelockPlus.disable().catchError((e) {
      debugPrint('‚ö†Ô∏è Wakelock disable failed: $e');
    });
    super.dispose();
  }

  @override
  Widget build(BuildContext context) {
    if (_hasError) {
      return LoadingScreen(
        hasError: true,
        errorMessage: _errorMessage,
      );
    }

    if (!_isInitialized) {
      return const LoadingScreen(
        message: '–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...',
      );
    }

    return const HomePage();
  }
}

/// –û—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
class HomePage extends StatefulWidget {
  const HomePage({super.key});

  @override
  State<HomePage> createState() => _HomePageState();
}

class _HomePageState extends State<HomePage> {
  int _currentIndex = 0;

  final List<Widget> _screens = [
    const MainScreen(),
    const StatsScreen(),
    const SettingsScreen(),
  ];

  @override
  Widget build(BuildContext context) {
    debugPrint('üè† Building HomePage');
    
    return Scaffold(
      backgroundColor: AppConstants.backgroundColor,
      body: _screens[_currentIndex],
      bottomNavigationBar: _buildBottomNavBar(),
    );
  }

  Widget _buildBottomNavBar() {
    return Container(
      decoration: BoxDecoration(
        color: Colors.black,
        border: Border(
          top: BorderSide(color: const Color(0xFF333333), width: 1),
        ),
      ),
      child: BottomNavigationBar(
        currentIndex: _currentIndex,
        onTap: (index) {
          setState(() {
            _currentIndex = index;
          });
        },
        backgroundColor: Colors.transparent,
        elevation: 0,
        selectedItemColor: AppConstants.textPrimaryColor,
        unselectedItemColor: AppConstants.textSecondaryColor,
        selectedFontSize: 10,
        unselectedFontSize: 10,
        selectedLabelStyle: const TextStyle(
          fontWeight: FontWeight.bold,
          letterSpacing: 1,
        ),
        unselectedLabelStyle: const TextStyle(
          fontWeight: FontWeight.bold,
          letterSpacing: 1,
        ),
        type: BottomNavigationBarType.fixed,
        items: const [
          BottomNavigationBarItem(
            icon: Padding(
              padding: EdgeInsets.only(bottom: 4),
              child: Text('‚ö°', style: TextStyle(fontSize: 24)),
            ),
            label: '–¢–ê–ô–ú–ï–†',
          ),
          BottomNavigationBarItem(
            icon: Padding(
              padding: EdgeInsets.only(bottom: 4),
              child: Text('üìä', style: TextStyle(fontSize: 24)),
            ),
            label: '–°–¢–ê–¢–ò–°–¢–ò–ö–ê',
          ),
          BottomNavigationBarItem(
            icon: Padding(
              padding: EdgeInsets.only(bottom: 4),
              child: Text('‚öôÔ∏è', style: TextStyle(fontSize: 24)),
            ),
            label: '–ù–ê–°–¢–†–û–ô–ö–ò',
          ),
        ],
      ),
    );
  }
}
```

### 3. –î–æ–±–∞–≤–∏—Ç—å import –≤ main.dart
–í –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞ –¥–æ–±–∞–≤—å—Ç–µ:
```dart
import 'dart:async';
```

### 4. –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å APK
```bash
cd first/BYPASS-1236/bypass-app/bypass-apk
flutter clean
flutter pub get
flutter build apk --release
```

## –ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ù–ï –∑–∞–≤–∏—Å–Ω–µ—Ç –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∑–∫–∏
- ‚úÖ –í—Å–µ –æ—à–∏–±–∫–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —É–ø–∞–ª–æ - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- ‚úÖ –¢–∞–π–º–∞—É—Ç—ã –Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é (5 —Å–µ–∫—É–Ω–¥)
- ‚úÖ Graceful degradation - —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –±–µ–∑ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π

## –ü—Ä–æ–≤–µ—Ä–∫–∞
–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ APK —Å–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏:
```bash
adb logcat | grep -i "flutter\|bypass"
```

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
‚úÖ JustAudioBackground initialized
‚úÖ Orientation set
‚úÖ SystemUI configured
üé® Building BypassApp
üîß Starting safe initialization...
üìä Initializing StatsProvider...
‚úÖ StatsProvider initialized
‚è±Ô∏è Initializing TimerProvider...
‚úÖ TimerProvider initialized
üéâ Initialization complete!
üè† Building HomePage
```
